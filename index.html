<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bulk Robots & Sitemap Viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
    box-sizing: border-box;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
    margin: 0;
    min-height: 100vh;
    background: radial-gradient(circle at top, #1b1b1b, #000);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
}

.container {
    width: 90%;
    max-width: 900px;
    text-align: center;
}

h1 {
    margin-bottom: 20px;
    font-size: 32px;
}

textarea {
    width: 100%;
    height: 180px;
    background: #222;
    color: #ddd;
    border: 1px solid #333;
    border-radius: 10px;
    padding: 15px;
    font-size: 15px;
    resize: vertical;
}

textarea::placeholder {
    color: #777;
}

button {
    margin-top: 20px;
    padding: 14px 28px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
}

.open {
    background: #0d6efd;
    color: #fff;
}

.open:hover {
    background: #0b5ed7;
}

.note {
    margin-top: 15px;
    font-size: 13px;
    color: #aaa;
}
</style>
</head>

<body>
<div class="container">
    <h1>Bulk Robots & Sitemap Viewer</h1>

    <textarea id="urls" placeholder="Enter URLs here (one per line)..."></textarea>

    <br>
    <button class="open" onclick="openAll()">Open All</button>

    <div class="note">
        ⚠️ This opens a generated HTML page showing robots.txt and the actual sitemap.xml content.
    </div>
</div>

<script>
function normalizeUrl(url) {
    url = url.trim();
    if (!url) return null;
    if (!/^https?:\/\//i.test(url)) {
        url = 'https://' + url;
    }
    return url.replace(/\/+$/, '');
}

function openAll() {
    const input = document.getElementById('urls').value;
    const sites = input.split('\n').map(normalizeUrl).filter(Boolean);

    if (!sites.length) {
        alert('Please enter at least one website.');
        return;
    }

    const resultPage = `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Robots & Sitemap Results</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    padding: 30px;
    background: #0b0b0b;
    color: #fff;
    font-family: system-ui, sans-serif;
}

.site-box {
    background: #161616;
    border: 1px solid #222;
    border-radius: 12px;
    padding: 20px;
    max-width: 70%;
    margin: 0 auto 30px;
}

.site-box h2 {
    margin: 0 0 15px;
    font-size: 20px;
    color: #4dabf7;
    word-break: break-all;
}

.flex {
    display: flex;
    gap: 15px;
}

.panel {
    flex: 1;
    background: #0e0e0e;
    border: 1px solid #333;
    border-radius: 8px;
    overflow: hidden;
}

.panel h3 {
    margin: 0;
    padding: 10px;
    background: #111;
    border-bottom: 1px solid #333;
    font-size: 14px;
    color: #bbb;
}

iframe {
    width: 100%;
    height: 260px;
    border: none;
    background: #000;
}

pre {
    margin: 0;
    padding: 12px;
    height: 260px;
    overflow: auto;
    font-size: 12px;
    line-height: 1.4;
    color: #cfcfcf;
    white-space: pre-wrap;
    word-break: break-word;
}

.error {
    color: #ff6b6b;
}
pre.sitemap {
  margin: 0;
  padding: 12px;
  height: 260px;
  overflow: auto;
  font-size: 12px;
  line-height: 1.4;
  color: #cfcfcf;
  white-space: pre-wrap;
  word-break: break-word;
}

@media (max-width: 900px) {
    .flex {
        flex-direction: column;
    }
}

</style>
</head>

<body>
<div id="content"></div>

<script>
const sites = ${JSON.stringify(sites)};

const container = document.getElementById('content');

sites.forEach(site => {
    const box = document.createElement('div');
    box.className = 'site-box';

    box.innerHTML = \`
        <h2>\${site}</h2>
        <div class="flex">
            <div class="panel">
                <h3>robots.txt</h3>
                <iframe src="\${site}/robots.txt"></iframe>
            </div>
<div class="panel">
  <h3>sitemap.xml</h3>
  <pre class="sitemap">Loading sitemap…</pre>
  <div style="padding:8px;text-align:center;">
    <a href="${site}/sitemap.xml" target="_blank" style="color:#4dabf7;">
      Open sitemap.xml in new tab
    </a>
  </div>
</div>
        </div>
    \`;

    container.appendChild(box);

    const pre = box.querySelector('.sitemap');

fetch(`/.netlify/functions/sitemap?url=${encodeURIComponent(site + '/sitemap.xml')}`)
  .then(res => {
    if (!res.ok) throw new Error('Blocked or not found');
    return res.text();
  })
  .then(text => {
    pre.textContent = text;
  })
  .catch(() => {
    pre.innerHTML = `
      <span class="error">
        Unable to load sitemap via proxy.
      </span>
    `;
  });
});
<\/script>

</body>
</html>
`;

    const blob = new Blob([resultPage], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    window.open(url, '_blank');
}
</script>
</body>
</html>
